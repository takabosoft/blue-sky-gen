(()=>{var t={99:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.buildPermutationTable=e.createNoise4D=e.createNoise3D=e.createNoise2D=void 0;const s=Math.sqrt(3),i=Math.sqrt(5),r=.5*(s-1),n=(3-s)/6,a=1/3,o=1/6,h=(i-1)/4,l=(5-i)/20,c=t=>0|Math.floor(t),u=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),d=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),p=new Float64Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);function v(t){const e=new Uint8Array(512);for(let t=0;t<256;t++)e[t]=t;for(let s=0;s<255;s++){const i=s+~~(t()*(256-s)),r=e[s];e[s]=e[i],e[i]=r}for(let t=256;t<512;t++)e[t]=e[t-256];return e}e.createNoise2D=function(t=Math.random){const e=v(t),s=new Float64Array(e).map((t=>u[t%12*2])),i=new Float64Array(e).map((t=>u[t%12*2+1]));return function(t,a){let o=0,h=0,l=0;const u=(t+a)*r,d=c(t+u),p=c(a+u),v=(d+p)*n,m=t-(d-v),y=a-(p-v);let f,x;m>y?(f=1,x=0):(f=0,x=1);const g=m-f+n,w=y-x+n,b=m-1+2*n,C=y-1+2*n,S=255&d,_=255&p;let $=.5-m*m-y*y;if($>=0){const t=S+e[_];$*=$,o=$*$*(s[t]*m+i[t]*y)}let M=.5-g*g-w*w;if(M>=0){const t=S+f+e[_+x];M*=M,h=M*M*(s[t]*g+i[t]*w)}let z=.5-b*b-C*C;if(z>=0){const t=S+1+e[_+1];z*=z,l=z*z*(s[t]*b+i[t]*C)}return 70*(o+h+l)}},e.createNoise3D=function(t=Math.random){const e=v(t),s=new Float64Array(e).map((t=>d[t%12*3])),i=new Float64Array(e).map((t=>d[t%12*3+1])),r=new Float64Array(e).map((t=>d[t%12*3+2]));return function(t,n,h){let l,u,d,p;const v=(t+n+h)*a,m=c(t+v),y=c(n+v),f=c(h+v),x=(m+y+f)*o,g=t-(m-x),w=n-(y-x),b=h-(f-x);let C,S,_,$,M,z;g>=w?w>=b?(C=1,S=0,_=0,$=1,M=1,z=0):g>=b?(C=1,S=0,_=0,$=1,M=0,z=1):(C=0,S=0,_=1,$=1,M=0,z=1):w<b?(C=0,S=0,_=1,$=0,M=1,z=1):g<b?(C=0,S=1,_=0,$=0,M=1,z=1):(C=0,S=1,_=0,$=1,M=1,z=0);const A=g-C+o,D=w-S+o,F=b-_+o,I=g-$+2*o,Y=w-M+2*o,k=b-z+2*o,N=g-1+.5,P=w-1+.5,V=b-1+.5,j=255&m,O=255&y,R=255&f;let q=.6-g*g-w*w-b*b;if(q<0)l=0;else{const t=j+e[O+e[R]];q*=q,l=q*q*(s[t]*g+i[t]*w+r[t]*b)}let T=.6-A*A-D*D-F*F;if(T<0)u=0;else{const t=j+C+e[O+S+e[R+_]];T*=T,u=T*T*(s[t]*A+i[t]*D+r[t]*F)}let H=.6-I*I-Y*Y-k*k;if(H<0)d=0;else{const t=j+$+e[O+M+e[R+z]];H*=H,d=H*H*(s[t]*I+i[t]*Y+r[t]*k)}let Z=.6-N*N-P*P-V*V;if(Z<0)p=0;else{const t=j+1+e[O+1+e[R+1]];Z*=Z,p=Z*Z*(s[t]*N+i[t]*P+r[t]*V)}return 32*(l+u+d+p)}},e.createNoise4D=function(t=Math.random){const e=v(t),s=new Float64Array(e).map((t=>p[t%32*4])),i=new Float64Array(e).map((t=>p[t%32*4+1])),r=new Float64Array(e).map((t=>p[t%32*4+2])),n=new Float64Array(e).map((t=>p[t%32*4+3]));return function(t,a,o,u){let d,p,v,m,y;const f=(t+a+o+u)*h,x=c(t+f),g=c(a+f),w=c(o+f),b=c(u+f),C=(x+g+w+b)*l,S=t-(x-C),_=a-(g-C),$=o-(w-C),M=u-(b-C);let z=0,A=0,D=0,F=0;S>_?z++:A++,S>$?z++:D++,S>M?z++:F++,_>$?A++:D++,_>M?A++:F++,$>M?D++:F++;const I=z>=3?1:0,Y=A>=3?1:0,k=D>=3?1:0,N=F>=3?1:0,P=z>=2?1:0,V=A>=2?1:0,j=D>=2?1:0,O=F>=2?1:0,R=z>=1?1:0,q=A>=1?1:0,T=D>=1?1:0,H=F>=1?1:0,Z=S-I+l,L=_-Y+l,U=$-k+l,B=M-N+l,E=S-P+2*l,G=_-V+2*l,J=$-j+2*l,K=M-O+2*l,Q=S-R+3*l,W=_-q+3*l,X=$-T+3*l,tt=M-H+3*l,et=S-1+4*l,st=_-1+4*l,it=$-1+4*l,rt=M-1+4*l,nt=255&x,at=255&g,ot=255&w,ht=255&b;let lt=.6-S*S-_*_-$*$-M*M;if(lt<0)d=0;else{const t=nt+e[at+e[ot+e[ht]]];lt*=lt,d=lt*lt*(s[t]*S+i[t]*_+r[t]*$+n[t]*M)}let ct=.6-Z*Z-L*L-U*U-B*B;if(ct<0)p=0;else{const t=nt+I+e[at+Y+e[ot+k+e[ht+N]]];ct*=ct,p=ct*ct*(s[t]*Z+i[t]*L+r[t]*U+n[t]*B)}let ut=.6-E*E-G*G-J*J-K*K;if(ut<0)v=0;else{const t=nt+P+e[at+V+e[ot+j+e[ht+O]]];ut*=ut,v=ut*ut*(s[t]*E+i[t]*G+r[t]*J+n[t]*K)}let dt=.6-Q*Q-W*W-X*X-tt*tt;if(dt<0)m=0;else{const t=nt+R+e[at+q+e[ot+T+e[ht+H]]];dt*=dt,m=dt*dt*(s[t]*Q+i[t]*W+r[t]*X+n[t]*tt)}let pt=.6-et*et-st*st-it*it-rt*rt;if(pt<0)y=0;else{const t=nt+1+e[at+1+e[ot+1+e[ht+1]]];pt*=pt,y=pt*pt*(s[t]*et+i[t]*st+r[t]*it+n[t]*rt)}return 27*(d+p+v+m+y)}},e.buildPermutationTable=v},188:(t,e,s)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Skybox=void 0;const i=s(321);e.Skybox=class{constructor(){this.skyColor2=new i.Vec3(0,35/255,127/255),this.skyColor1=new i.Vec3(94/255,192/255,249/255),this.landColor=new i.Vec3(0,.5,1)}getColor(t){return t.direction.y>=0?i.Vec3.mix(this.skyColor1,this.skyColor2,t.direction.y):this.landColor}}},235:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.degToRad=function(t){return t*Math.PI/180},e.clamp=function(t,e,s){return Math.max(e,Math.min(t,s))}},250:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Canvas=void 0,e.Canvas=class{constructor(t,e){this.canvas=$("<canvas>")[0],this.canvas.width=t,this.canvas.height=e,this.ctx=this.canvas.getContext("2d")}get width(){return this.canvas.width}get height(){return this.canvas.height}}},321:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Vec3=void 0;class s{constructor(t,e,s){this.x=t,this.y=e,this.z=s}get r(){return this.x}get g(){return this.y}get b(){return this.z}get length(){return Math.sqrt(this.x**2+this.y**2+this.z**2)}get normal(){const t=this.length;return t>0?new s(this.x/t,this.y/t,this.z/t):s.zero}add(t){return new s(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return new s(this.x-t.x,this.y-t.y,this.z-t.z)}mul(t){return new s(this.x*t,this.y*t,this.z*t)}cross(t){return new s(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}static mix(t,e,s){return t.mul(1-s).add(e.mul(s))}}e.Vec3=s,s.zero=new s(0,0,0)},417:(t,e,s)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Camera=void 0;const i=s(235),r=s(680);e.Camera=class{constructor(t,e,s,r,n){const a=(0,i.degToRad)(r),o=2*Math.tan(a/2),h=n*o,l=t.sub(e).normal,c=s.cross(l).normal,u=l.cross(c);this.origin=t,this.horizontal=c.mul(h),this.vertical=u.mul(o),this.lowerLeftCorner=this.origin.sub(this.horizontal.mul(.5)).sub(this.vertical.mul(.5)).sub(l)}get_ray(t,e){return new r.Ray(this.origin,this.lowerLeftCorner.add(this.horizontal.mul(t)).add(this.vertical.mul(e)).sub(this.origin).normal)}}},597:(t,e,s)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Cloud=void 0;const i=s(188),r=s(321),n=s(235);e.Cloud=class{constructor(t,e,s,n){this.noise=t,this.maxSteps=e,this.alphaScale=s,this.maxY=n,this.cloudCol=new r.Vec3(1,1,1),this.minY=100,this.skybox=new i.Skybox}calcHitAtY(t,e){if(0==e.direction.y)return;const s=(t-e.origin.y)/e.direction.y;return s<=0?void 0:s}getNoise(t,e,s){const i=(this.noise(t.x*e,t.y*e,t.z*e)+1)/2;return i>=s?1/(1-s)*(i-s):0}sampleCloudDensity(t){return this.getNoise(t.add(new r.Vec3(1e3,0,0)),.001,.2)**2*this.getNoise(t,.03,.3)**2+this.getNoise(t,.001,.2)*this.getNoise(t,.008,.3)**2}march(t){let e=0,s=1;const i=this.calcHitAtY(this.minY,t),r=this.calcHitAtY(this.maxY,t);if(null==i||null==r)return 0;const a=this.maxSteps,o=(r-i)/a,h=this.alphaScale;let l=i;for(let i=0;i<a;i++){const i=t.at(l);if(i.sub(t.origin).length>1e3)break;const r=this.sampleCloudDensity(i),a=(0,n.clamp)(r*o*h,0,1);if(e+=a*s,s*=1-a,s<.01)break;l+=o}return(0,n.clamp)(e,0,1)}getColor(t){const e=this.skybox.getColor(t);return r.Vec3.mix(e,this.cloudCol,this.march(t))}}},680:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Ray=void 0,e.Ray=class{constructor(t,e){this.origin=t,this.direction=e}at(t){return this.origin.add(this.direction.mul(t))}}},835:function(t){t.exports=function(){"use strict";return t.importState=function(e){var s=new t;return s.importState(e),s},t;function t(){return function(t){var e=0,s=0,i=0,r=1;0==t.length&&(t=[+new Date]);var n=function(){var t=4022871197,e=function(e){e=e.toString();for(var s=0;s<e.length;s++){var i=.02519603282416938*(t+=e.charCodeAt(s));i-=t=i>>>0,t=(i*=t)>>>0,t+=4294967296*(i-=t)}return 2.3283064365386963e-10*(t>>>0)};return e.version="Mash 0.9",e}();e=n(" "),s=n(" "),i=n(" ");for(var a=0;a<t.length;a++)(e-=n(t[a]))<0&&(e+=1),(s-=n(t[a]))<0&&(s+=1),(i-=n(t[a]))<0&&(i+=1);n=null;var o=function(){var t=2091639*e+2.3283064365386963e-10*r;return e=s,s=i,i=t-(r=0|t)};return o.next=o,o.uint32=function(){return 4294967296*o()},o.fract53=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.version="Alea 0.9",o.args=t,o.exportState=function(){return[e,s,i,r]},o.importState=function(t){e=+t[0]||0,s=+t[1]||0,i=+t[2]||0,r=+t[3]||0},o}(Array.prototype.slice.call(arguments))}}()},927:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(417),n=s(250),a=s(321),o=s(597),h=s(99),l=i(s(835));$((()=>new c));class c{constructor(){this.canvas=new n.Canvas(160,120),this.seedInput=$('<input type="text" value="seed">').on("input",(()=>{this._noise=void 0,this.preview()})),this.targetYSlider=$('<input type="range" min="0.6" max="3" step="0.001" value="0.9">').on("input",(()=>this.preview())),this.cameraZSlider=$('<input type="range" min="0" max="10000" step="0.001" value="0">').on("input",(()=>this.preview())),this.alphaScaleSlider=$('<input type="range" min="0" max="0.05" step="0.001" value="0.03">').on("input",(()=>this.preview())),this.maxYSlider=$('<input type="range" min="150" max="400" step="0.001" value="200">').on("input",(()=>this.preview())),this.widthInput=$('<input type="number" min="1" value="800">'),this.heightInput=$('<input type="number" min="1" value="600">'),this.resultDiv=$("<div>"),$(document.body).append($("<h2>").text("1. 各種設定を行ってください。"),$('<div class="preview-container">').append(this.canvas.canvas,$('<div class="preview-params">').append($("<div>").text("シード値："),this.seedInput,$("<div>").text("カメラの向き："),this.targetYSlider,$("<div>").text("カメラ位置："),this.cameraZSlider,$("<div>").text("雲の濃さ："),this.alphaScaleSlider,$("<div>").text("雲の厚み："),this.maxYSlider)),$("<h2>").text("2. 問題無ければ生成ボタンを押してください。"),$('<div class="render-params">').append(this.widthInput,$("<div>").text("×"),this.heightInput,$("<button>").text("高画質画像生成").on("click",(()=>this.startRender())),$("<div>").text("※生成には時間が掛かります。終わったら画像を右クリックしてコピーや保存を行ってください。")),this.resultDiv,$("<h2>").text("その他"),$("<ul>").append(["単純な青空を計算で生成します。","生成した画像の著作権は利用者に帰属します。商用利用可能です（クレジット表記などは歓迎いたします）。","3Dシンプレックスノイズとレイマーチングを使って雲を3次元風にレンダリングしていますが、ライティング処理が無いためかリアリティにはやや欠けます。"].map((t=>$("<li>").text(t))))),this.preview()}get seed(){return this.seedInput.val()+""}get noise(){return null==this._noise&&(this._noise=(0,h.createNoise3D)((0,l.default)(this.seed))),this._noise}get alphaScale(){return parseFloat(this.alphaScaleSlider.val()+"")}get maxY(){return parseFloat(this.maxYSlider.val()+"")}createCamera(t,e){const s=t/e,i=parseFloat(this.targetYSlider.val()+""),n=-parseFloat(this.cameraZSlider.val()+"");return new r.Camera(new a.Vec3(0,0,n),new a.Vec3(0,i,n-1),new a.Vec3(0,1,0),70,s)}preview(){const t=new o.Cloud(this.noise,40,this.alphaScale,this.maxY),e=this.canvas.width,s=this.canvas.height,i=this.canvas.ctx.createImageData(this.canvas.width,this.canvas.height),r=i.data,n=this.createCamera(e,s);for(let i=0,a=0;i<s;i++)for(let o=0;o<e;o++,a+=4){const h=o/(e-1),l=1-i/(s-1),c=n.get_ray(h,l),u=t.getColor(c);r[a+0]=255*u.r,r[a+1]=255*u.g,r[a+2]=255*u.b,r[a+3]=255}this.canvas.ctx.putImageData(i,0,0)}startRender(){var t;const e=Math.max(Math.floor(parseInt(this.widthInput.val()+"")),1),s=Math.max(Math.floor(parseInt(this.heightInput.val()+"")),1);null===(t=this.render)||void 0===t||t.destroy();const i=this.createCamera(e,s);this.render=new u(e,s,new o.Cloud(this.noise,100,this.alphaScale,this.maxY),i),this.resultDiv.empty().append($(this.render.canvas.canvas).addClass("render-canvas")),this.render.start()}}class u{constructor(t,e,s,i){this.cloud=s,this.camera=i,this.enable=!0,this.canvas=new n.Canvas(t,e)}start(){const t=this.canvas.ctx.createImageData(this.canvas.width,1),e=t.data;let s=0;const i=()=>{if(!this.enable)return;const r=this.canvas.width,n=this.canvas.height;for(let t=0,i=0;t<r;t++,i+=4){const a=t/(r-1),o=1-s/(n-1),h=this.camera.get_ray(a,o),l=this.cloud.getColor(h);e[i+0]=255*l.r,e[i+1]=255*l.g,e[i+2]=255*l.b,e[i+3]=255}this.canvas.ctx.putImageData(t,0,s),s++,s<this.canvas.height&&requestAnimationFrame(i)};requestAnimationFrame(i)}destroy(){this.enable=!1}}}},e={};!function s(i){var r=e[i];if(void 0!==r)return r.exports;var n=e[i]={exports:{}};return t[i].call(n.exports,n,n.exports,s),n.exports}(927)})();