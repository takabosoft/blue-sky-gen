(()=>{var t={99:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.buildPermutationTable=e.createNoise4D=e.createNoise3D=e.createNoise2D=void 0;const i=Math.sqrt(3),s=Math.sqrt(5),r=.5*(i-1),n=(3-i)/6,a=1/3,o=1/6,l=(s-1)/4,h=(5-s)/20,c=t=>0|Math.floor(t),u=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),d=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),p=new Float64Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);function v(t){const e=new Uint8Array(512);for(let t=0;t<256;t++)e[t]=t;for(let i=0;i<255;i++){const s=i+~~(t()*(256-i)),r=e[i];e[i]=e[s],e[s]=r}for(let t=256;t<512;t++)e[t]=e[t-256];return e}e.createNoise2D=function(t=Math.random){const e=v(t),i=new Float64Array(e).map((t=>u[t%12*2])),s=new Float64Array(e).map((t=>u[t%12*2+1]));return function(t,a){let o=0,l=0,h=0;const u=(t+a)*r,d=c(t+u),p=c(a+u),v=(d+p)*n,m=t-(d-v),f=a-(p-v);let y,x;m>f?(y=1,x=0):(y=0,x=1);const w=m-y+n,g=f-x+n,b=m-1+2*n,S=f-1+2*n,C=255&d,$=255&p;let _=.5-m*m-f*f;if(_>=0){const t=C+e[$];_*=_,o=_*_*(i[t]*m+s[t]*f)}let M=.5-w*w-g*g;if(M>=0){const t=C+y+e[$+x];M*=M,l=M*M*(i[t]*w+s[t]*g)}let D=.5-b*b-S*S;if(D>=0){const t=C+1+e[$+1];D*=D,h=D*D*(i[t]*b+s[t]*S)}return 70*(o+l+h)}},e.createNoise3D=function(t=Math.random){const e=v(t),i=new Float64Array(e).map((t=>d[t%12*3])),s=new Float64Array(e).map((t=>d[t%12*3+1])),r=new Float64Array(e).map((t=>d[t%12*3+2]));return function(t,n,l){let h,u,d,p;const v=(t+n+l)*a,m=c(t+v),f=c(n+v),y=c(l+v),x=(m+f+y)*o,w=t-(m-x),g=n-(f-x),b=l-(y-x);let S,C,$,_,M,D;w>=g?g>=b?(S=1,C=0,$=0,_=1,M=1,D=0):w>=b?(S=1,C=0,$=0,_=1,M=0,D=1):(S=0,C=0,$=1,_=1,M=0,D=1):g<b?(S=0,C=0,$=1,_=0,M=1,D=1):w<b?(S=0,C=1,$=0,_=0,M=1,D=1):(S=0,C=1,$=0,_=1,M=1,D=0);const F=w-S+o,z=g-C+o,A=b-$+o,R=w-_+2*o,I=g-M+2*o,P=b-D+2*o,k=w-1+.5,Y=g-1+.5,j=b-1+.5,O=255&m,V=255&f,N=255&y;let T=.6-w*w-g*g-b*b;if(T<0)h=0;else{const t=O+e[V+e[N]];T*=T,h=T*T*(i[t]*w+s[t]*g+r[t]*b)}let q=.6-F*F-z*z-A*A;if(q<0)u=0;else{const t=O+S+e[V+C+e[N+$]];q*=q,u=q*q*(i[t]*F+s[t]*z+r[t]*A)}let E=.6-R*R-I*I-P*P;if(E<0)d=0;else{const t=O+_+e[V+M+e[N+D]];E*=E,d=E*E*(i[t]*R+s[t]*I+r[t]*P)}let H=.6-k*k-Y*Y-j*j;if(H<0)p=0;else{const t=O+1+e[V+1+e[N+1]];H*=H,p=H*H*(i[t]*k+s[t]*Y+r[t]*j)}return 32*(h+u+d+p)}},e.createNoise4D=function(t=Math.random){const e=v(t),i=new Float64Array(e).map((t=>p[t%32*4])),s=new Float64Array(e).map((t=>p[t%32*4+1])),r=new Float64Array(e).map((t=>p[t%32*4+2])),n=new Float64Array(e).map((t=>p[t%32*4+3]));return function(t,a,o,u){let d,p,v,m,f;const y=(t+a+o+u)*l,x=c(t+y),w=c(a+y),g=c(o+y),b=c(u+y),S=(x+w+g+b)*h,C=t-(x-S),$=a-(w-S),_=o-(g-S),M=u-(b-S);let D=0,F=0,z=0,A=0;C>$?D++:F++,C>_?D++:z++,C>M?D++:A++,$>_?F++:z++,$>M?F++:A++,_>M?z++:A++;const R=D>=3?1:0,I=F>=3?1:0,P=z>=3?1:0,k=A>=3?1:0,Y=D>=2?1:0,j=F>=2?1:0,O=z>=2?1:0,V=A>=2?1:0,N=D>=1?1:0,T=F>=1?1:0,q=z>=1?1:0,E=A>=1?1:0,H=C-R+h,L=$-I+h,Z=_-P+h,U=M-k+h,W=C-Y+2*h,B=$-j+2*h,G=_-O+2*h,J=M-V+2*h,K=C-N+3*h,Q=$-T+3*h,X=_-q+3*h,tt=M-E+3*h,et=C-1+4*h,it=$-1+4*h,st=_-1+4*h,rt=M-1+4*h,nt=255&x,at=255&w,ot=255&g,lt=255&b;let ht=.6-C*C-$*$-_*_-M*M;if(ht<0)d=0;else{const t=nt+e[at+e[ot+e[lt]]];ht*=ht,d=ht*ht*(i[t]*C+s[t]*$+r[t]*_+n[t]*M)}let ct=.6-H*H-L*L-Z*Z-U*U;if(ct<0)p=0;else{const t=nt+R+e[at+I+e[ot+P+e[lt+k]]];ct*=ct,p=ct*ct*(i[t]*H+s[t]*L+r[t]*Z+n[t]*U)}let ut=.6-W*W-B*B-G*G-J*J;if(ut<0)v=0;else{const t=nt+Y+e[at+j+e[ot+O+e[lt+V]]];ut*=ut,v=ut*ut*(i[t]*W+s[t]*B+r[t]*G+n[t]*J)}let dt=.6-K*K-Q*Q-X*X-tt*tt;if(dt<0)m=0;else{const t=nt+N+e[at+T+e[ot+q+e[lt+E]]];dt*=dt,m=dt*dt*(i[t]*K+s[t]*Q+r[t]*X+n[t]*tt)}let pt=.6-et*et-it*it-st*st-rt*rt;if(pt<0)f=0;else{const t=nt+1+e[at+1+e[ot+1+e[lt+1]]];pt*=pt,f=pt*pt*(i[t]*et+s[t]*it+r[t]*st+n[t]*rt)}return 27*(d+p+v+m+f)}},e.buildPermutationTable=v},187:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PreviewRenderer=void 0;const s=i(250);e.PreviewRenderer=class{constructor(){this.canvas=new s.Canvas(160,120),this.imageData=this.canvas.ctx.createImageData(this.canvas.width,this.canvas.height)}update(t,e){const i=this.imageData.data,s=this.canvas.width,r=this.canvas.height;for(let n=0,a=0;n<r;n++)for(let o=0;o<s;o++,a+=4){const l=o/(s-1),h=1-n/(r-1),c=e.getRay(l,h),u=t.getColor(c);i[a+0]=255*u.r,i[a+1]=255*u.g,i[a+2]=255*u.b,i[a+3]=255}this.canvas.ctx.putImageData(this.imageData,0,0)}}},188:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Skybox=void 0;const s=i(321);e.Skybox=class{constructor(){this.skyColor2=new s.Vec3(0,35/255,127/255),this.skyColor1=new s.Vec3(94/255,192/255,249/255),this.landColor=new s.Vec3(0,.5,1)}getColor(t){return t.direction.y>=0?s.Vec3.mix(this.skyColor1,this.skyColor2,t.direction.y):this.landColor}}},235:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.degToRad=function(t){return t*Math.PI/180},e.clamp=function(t,e,i){return Math.max(e,Math.min(t,i))}},250:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Canvas=void 0,e.Canvas=class{constructor(t,e){this.canvas=$("<canvas>")[0],this.canvas.width=t,this.canvas.height=e,this.ctx=this.canvas.getContext("2d")}get width(){return this.canvas.width}get height(){return this.canvas.height}}},321:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Vec3=void 0;class i{constructor(t,e,i){this.x=t,this.y=e,this.z=i}get r(){return this.x}get g(){return this.y}get b(){return this.z}get length(){return Math.sqrt(this.x**2+this.y**2+this.z**2)}get normal(){const t=this.length;return t>0?new i(this.x/t,this.y/t,this.z/t):i.zero}add(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z)}mul(t){return new i(this.x*t,this.y*t,this.z*t)}cross(t){return new i(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}static mix(t,e,i){return t.mul(1-i).add(e.mul(i))}}e.Vec3=i,i.zero=new i(0,0,0)},417:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Camera=void 0;const s=i(235),r=i(680);e.Camera=class{constructor(t,e,i,r,n){const a=(0,s.degToRad)(r),o=2*Math.tan(a/2),l=n*o,h=t.sub(e).normal,c=i.cross(h).normal,u=h.cross(c);this.origin=t,this.horizontal=c.mul(l),this.vertical=u.mul(o),this.lowerLeftCorner=this.origin.sub(this.horizontal.mul(.5)).sub(this.vertical.mul(.5)).sub(h)}getRay(t,e){return new r.Ray(this.origin,this.lowerLeftCorner.add(this.horizontal.mul(t)).add(this.vertical.mul(e)).sub(this.origin).normal)}}},495:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ExportRenderer=void 0;const s=i(250);e.ExportRenderer=class{constructor(t,e,i,r){this.cloud=i,this.camera=r,this.enable=!0,this.canvas=new s.Canvas(t,e)}start(){const t=this.canvas.ctx.createImageData(this.canvas.width,1),e=t.data;let i=0;const s=()=>{if(!this.enable)return;const r=this.canvas.width,n=this.canvas.height;for(let t=0,s=0;t<r;t++,s+=4){const a=t/(r-1),o=1-i/(n-1),l=this.camera.getRay(a,o),h=this.cloud.getColor(l);e[s+0]=255*h.r,e[s+1]=255*h.g,e[s+2]=255*h.b,e[s+3]=255}if(this.canvas.ctx.putImageData(t,0,i),i++,i<this.canvas.height)requestAnimationFrame(s);else{const t=new Image;t.src=this.canvas.canvas.toDataURL("image/png"),$(this.canvas.canvas).replaceWith(t)}};requestAnimationFrame(s)}destroy(){this.enable=!1}}},597:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Cloud=void 0;const s=i(188),r=i(321),n=i(235);e.Cloud=class{constructor(t,e,i,n,a,o,l,h){this.noise=t,this.maxSteps=e,this.alphaScale=i,this.minY=n,this.maxY=a,this.cloudCol=new r.Vec3(1,1,1),this.skybox=new s.Skybox;let c=[];for(let t=0;t<o;t++)c.push({scale:l*4**t,depth:h**t});this.fbmTable=c}calcHitAtY(t,e){if(0==e.direction.y)return;const i=(t-e.origin.y)/e.direction.y;return i<=0?void 0:i}getNoise(t,e){return this.noise(t.x*e,t.y*e,t.z*e)}sampleCloudDensity(t){let e=0;for(const i of this.fbmTable)e+=this.getNoise(t,i.scale)*i.depth;return e}march(t){let e=0,i=1;const s=this.calcHitAtY(this.minY,t),r=this.calcHitAtY(this.maxY,t);if(null==s||null==r)return 0;const a=this.maxSteps,o=(r-s)/a,l=this.alphaScale;let h=s;for(let s=0;s<a;s++){const s=t.at(h),r=this.sampleCloudDensity(s),a=(0,n.clamp)(r*o*l,0,1);if(e+=a*i,i*=1-a,i<.01)break;h+=o}return(0,n.clamp)(e,0,1)}getColor(t){const e=this.skybox.getColor(t);return r.Vec3.mix(e,this.cloudCol,this.march(t))}}},680:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Ray=void 0,e.Ray=class{constructor(t,e){this.origin=t,this.direction=e}at(t){return this.origin.add(this.direction.mul(t))}}},835:function(t){t.exports=function(){"use strict";return t.importState=function(e){var i=new t;return i.importState(e),i},t;function t(){return function(t){var e=0,i=0,s=0,r=1;0==t.length&&(t=[+new Date]);var n=function(){var t=4022871197,e=function(e){e=e.toString();for(var i=0;i<e.length;i++){var s=.02519603282416938*(t+=e.charCodeAt(i));s-=t=s>>>0,t=(s*=t)>>>0,t+=4294967296*(s-=t)}return 2.3283064365386963e-10*(t>>>0)};return e.version="Mash 0.9",e}();e=n(" "),i=n(" "),s=n(" ");for(var a=0;a<t.length;a++)(e-=n(t[a]))<0&&(e+=1),(i-=n(t[a]))<0&&(i+=1),(s-=n(t[a]))<0&&(s+=1);n=null;var o=function(){var t=2091639*e+2.3283064365386963e-10*r;return e=i,i=s,s=t-(r=0|t)};return o.next=o,o.uint32=function(){return 4294967296*o()},o.fract53=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.version="Alea 0.9",o.args=t,o.exportState=function(){return[e,i,s,r]},o.importState=function(t){e=+t[0]||0,i=+t[1]||0,s=+t[2]||0,r=+t[3]||0},o}(Array.prototype.slice.call(arguments))}}()},927:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(417),n=i(321),a=i(597),o=i(99),l=s(i(835)),h=i(495),c=i(187);$((()=>new u));class u{constructor(){this.previewRenderer=new c.PreviewRenderer,this.seedInput=$('<input type="text" value="seed">').on("input",(()=>{this._noise=void 0,this.preview()})),this.targetYSlider=$('<input type="range" min="0.6" max="3" step="0.001" value="0.9">').on("input",(()=>this.preview())),this.cameraZSlider=$('<input type="range" min="0" max="10000" step="0.001" value="0">').on("input",(()=>this.preview())),this.alphaScaleSlider=$('<input type="range" min="0" max="0.05" step="0.001" value="0.03">').on("input",(()=>this.preview())),this.minYSlider=$('<input type="range" min="100" max="400" step="0.001" value="100">').on("input",(()=>this.preview())),this.thicknessSlider=$('<input type="range" min="10" max="700" step="0.001" value="100">').on("input",(()=>this.preview())),this.fbmScaleSlider=$('<input type="range" min="0.00001" max="0.01" step="0.00001" value="0.0006">').on("input",(()=>this.preview())),this.fbmDepthSlider=$('<input type="range" min="0.1" max="2" step="0.001" value="0.5">').on("input",(()=>this.preview())),this.widthInput=$('<input type="number" min="1" value="800">'),this.heightInput=$('<input type="number" min="1" value="600">'),this.resultDiv=$('<div class="render-result">'),$(document.body).append($("<h2>").text("1. 各種設定を行ってください。"),$('<div class="preview-container">').append(this.previewRenderer.canvas.canvas,$('<div class="preview-params">').append($("<div>").text("シード値："),this.seedInput,$("<div>").text("カメラの向き："),this.targetYSlider,$("<div>").text("カメラ位置："),this.cameraZSlider,$("<div>").text("雲の高度："),this.minYSlider,$("<div>").text("雲の濃さ："),this.alphaScaleSlider,$("<div>").text("雲の厚み："),this.thicknessSlider,$("<div>").text("雲の細かさ："),this.fbmScaleSlider,$("<div>").text("雲の細部強調："),this.fbmDepthSlider)),$("<h2>").text("2. 問題無ければ生成ボタンを押してください。"),$('<div class="render-params">').append(this.widthInput,$("<div>").text("×"),this.heightInput,$("<button>").text("高画質画像生成").on("click",(()=>this.renderForExport())),$("<div>").text("※生成には時間が掛かります。終わったら画像を右クリックしてコピーや保存を行ってください。")),this.resultDiv,$("<h2>").text("その他"),$("<ul>").append(["単純な青空を計算で生成します。","生成した画像の著作権は利用者に帰属します。商用利用可能です（クレジット表記などは歓迎いたします）。","3Dシンプレックスノイズとレイマーチングを使って雲を3次元風にレンダリングしていますが、ライティング処理が無いためかリアリティにはやや欠けます。"].map((t=>$("<li>").text(t))))),this.preview()}get seed(){return this.seedInput.val()+""}get noise(){return null==this._noise&&(this._noise=(0,o.createNoise3D)((0,l.default)(this.seed))),this._noise}createCamera(t,e){const i=t/e,s=parseFloat(this.targetYSlider.val()+""),a=-parseFloat(this.cameraZSlider.val()+"");return new r.Camera(new n.Vec3(0,0,a),new n.Vec3(0,s,a-1),new n.Vec3(0,1,0),70,i)}createCloud(t){const e=parseFloat(this.alphaScaleSlider.val()+""),i=parseFloat(this.fbmScaleSlider.val()+""),s=parseFloat(this.fbmDepthSlider.val()+""),r=parseFloat(this.minYSlider.val()+""),n=r+parseFloat(this.thicknessSlider.val()+"");return new a.Cloud(this.noise,t?20:100,e,r,n,t?4:10,i,s)}preview(){const t=this.createCloud(!0),e=this.createCamera(this.previewRenderer.canvas.width,this.previewRenderer.canvas.height);this.previewRenderer.update(t,e)}renderForExport(){var t;const e=Math.max(Math.floor(parseInt(this.widthInput.val()+"")),1),i=Math.max(Math.floor(parseInt(this.heightInput.val()+"")),1);null===(t=this.render)||void 0===t||t.destroy();const s=this.createCamera(e,i);this.render=new h.ExportRenderer(e,i,this.createCloud(!1),s),this.resultDiv.empty().append($(this.render.canvas.canvas)),this.render.start()}}}},e={};!function i(s){var r=e[s];if(void 0!==r)return r.exports;var n=e[s]={exports:{}};return t[s].call(n.exports,n,n.exports,i),n.exports}(927)})();